<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成長ランキング - ROK Kingdom Data</title>
    <meta name="description" content="Rise of Kingdoms プレイヤー成長ランキング">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏰</text></svg>">

    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" defer></script>
</head>
<body>
    <div class="container">
        <h1 style="cursor: pointer;" onclick="window.location.href='home.html'" title="ホームに戻る">⚔️ ROK Kingdom Data</h1>
        <div class="subtitle">成長ランキング</div>
        <div class="update-info">
            CSVファイル最終更新: <span id="updateDate">確認中...</span> |
            データ件数: <span id="dataCount">-</span>件
        </div>

        <!-- ナビゲーション -->
        <nav style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <a href="home.html" style="padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 8px;">← ホームに戻る</a>
            <a href="dataList.html" style="padding: 10px 20px; background: #27ae60; color: white; text-decoration: none; border-radius: 8px;">データ一覧</a>
            <a href="topStats.html" style="padding: 10px 20px; background: #e74c3c; color: white; text-decoration: none; border-radius: 8px;">上位300人統計</a>
            <a href="individual.html" style="padding: 10px 20px; background: #f39c12; color: white; text-decoration: none; border-radius: 8px;">個人分析</a>
        </nav>

        <!-- 統計情報 -->
        <div class="stats">
            <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);">
                <h3>分析期間</h3>
                <p id="growthPeriodDisplay">未選択</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #16a085 100%);">
                <h3>分析対象数</h3>
                <p id="growthAnalysisCount">0</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);">
                <h3>最大成長者</h3>
                <p id="growthTopPlayer" style="font-size: 16px;">-</p>
            </div>
        </div>

        <!-- 期間選択とフィルター -->
        <div class="filter-section">
            <div class="date-filter" style="margin-bottom: 15px;">
                <label style="font-weight: 600;">期間選択:</label>
                <input type="date" id="growthStartDate">
                <span>～</span>
                <input type="date" id="growthEndDate">
                <button onclick="applyGrowthFilter()">適用</button>
                <button class="preset-btn" onclick="setGrowthPreset('latest')">最新データ</button>
                <button class="preset-btn" onclick="setGrowthPreset('week')">直近7日</button>
                <button class="preset-btn" onclick="setGrowthPreset('month')">直近30日</button>
                <button class="preset-btn" onclick="setGrowthPreset('all')">全期間</button>
                <button class="clear-btn" onclick="clearGrowthFilter()">クリア</button>
            </div>

            <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>指標:</label>
                    <select id="growthMetric" onchange="updateGrowthRanking()">
                        <option value="Power">Power</option>
                        <option value="T4-Kills">T4-Kills</option>
                        <option value="T5-Kills">T5-Kills</option>
                        <option value="Total Kill Points">Total Kill Points</option>
                        <option value="Dead Troops">Dead Troops</option>
                        <option value="Troops Power">Troops Power</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>表示数:</label>
                    <select id="growthLimit" onchange="updateGrowthRanking()">
                        <option value="50">Top 50</option>
                        <option value="100">Top 100</option>
                        <option value="300">Top 300</option>
                        <option value="9999">全員</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>並び順:</label>
                    <select id="growthSort" onchange="updateGrowthRanking()">
                        <option value="amount">増加量順</option>
                        <option value="rate">成長率順</option>
                        <option value="current">現在値順</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>フィルター:</label>
                    <select id="growthFilter" onchange="updateGrowthRanking()">
                        <option value="all">全て表示</option>
                        <option value="growth">成長のみ</option>
                        <option value="decline">減少のみ</option>
                    </select>
                </div>
            </div>

            <!-- 検索機能 -->
            <div style="margin-top: 15px;">
                <div class="search-box">
                    <input type="text" id="growthSearchInput" placeholder="🔍 名前、ID、同盟で検索..." oninput="filterGrowthBySearch()">
                </div>
            </div>
        </div>

        <!-- ランキングテーブル -->
        <div class="table-container">
            <table style="width: 100%; border-collapse: collapse; background: white;">
                <thead style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white;">
                    <tr>
                        <th style="padding: 15px; text-align: center; font-weight: 600; position: sticky; top: 0; z-index: 10;">順位</th>
                        <th class="sortable" style="padding: 15px; text-align: center; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('id')">ID</th>
                        <th class="sortable" style="padding: 15px; text-align: left; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('name')">名前</th>
                        <th class="sortable" style="padding: 15px; text-align: left; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('alliance')">同盟</th>
                        <th class="sortable" style="padding: 15px; text-align: right; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('startValue')">期間開始時</th>
                        <th class="sortable" style="padding: 15px; text-align: right; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('endValue')">期間終了時</th>
                        <th class="sortable" style="padding: 15px; text-align: right; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('difference')">増加量</th>
                        <th class="sortable" style="padding: 15px; text-align: right; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('growthRate')">成長率</th>
                        <th class="sortable" style="padding: 15px; text-align: right; font-weight: 600; position: sticky; top: 0; z-index: 10; cursor: pointer; user-select: none;" onclick="sortGrowthTable('dailyAverage')">日平均</th>
                    </tr>
                </thead>
                <tbody id="growthTableBody" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 60px 20px; color: #7f8c8d;">
                            <h3>期間を選択して「適用」をクリックしてください</h3>
                            <p>またはプリセットボタンから期間を選択できます</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="growth.js"></script>
</body>
</html>
