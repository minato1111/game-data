<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>データ一覧 - ROK Kingdom Data</title>
    <meta name="description" content="Rise of Kingdoms プレイヤーデータ一覧">

    <!-- Favicon設定 -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏰</text></svg>">

    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" defer></script>
    <script src="common.js" defer></script>
</head>
<body>
    <div class="container">
        <h1 style="cursor: pointer;" onclick="window.location.href='index.html'" title="ホームに戻る">⚔️ ROK Kingdom Data 一覧</h1>
        <div class="subtitle">Rise of Kingdoms - データ統計・分析ツール</div>
        <div class="update-info">
            CSVファイル最終更新: <span id="updateDate">確認中...</span> |
            データ件数: <span id="dataCount">-</span>件
        </div>

        <!-- ナビゲーション -->
        <nav style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <a href="index.html" style="padding: 10px 20px; background: #95a5a6; color: white; text-decoration: none; border-radius: 8px; transition: all 0.3s;">ホーム</a>
            <a href="dataList.html" class="active" style="padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 8px; transition: all 0.3s;">データ一覧</a>
            <a href="kvkList.html" style="padding: 10px 20px; background: #95a5a6; color: white; text-decoration: none; border-radius: 8px; transition: all 0.3s;">KVKノルマ一覧</a>
        </nav>

        <!-- データ一覧コンテンツ -->
        <div style="max-width: 100%; margin: 0 auto; padding: 20px 0;">
            <div class="stats">
                <div class="stat-card">
                    <h3>総レコード数</h3>
                    <p id="totalRecords">読み込み中...</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>Power上位300位合計 (最終データ日)</h3>
                    <p id="top300Power">計算中...</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3>最終データ日</h3>
                    <p id="lastUpdate" style="font-size: 16px;">-</p>
                </div>
            </div>

            <!-- 拡張フィルター機能 -->
            <div class="filter-section">
                <div class="date-filter" style="margin-bottom: 15px;">
                    <label style="font-weight: 600;">期間選択:</label>
                    <input type="date" id="dataStartDate">
                    <span>～</span>
                    <input type="date" id="dataEndDate">
                    <button onclick="applyDataFilter()">適用</button>
                    <button class="preset-btn" onclick="setDataPreset('latest')">最新データ</button>
                    <button class="preset-btn" onclick="setDataPreset('week')">直近7日</button>
                    <button class="preset-btn" onclick="setDataPreset('month')">直近30日</button>
                    <button class="preset-btn" onclick="setDataPreset('all')">全期間</button>
                    <button class="clear-btn" onclick="clearDataFilter()">クリア</button>
                </div>

                <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label>指標:</label>
                        <select id="dataMetric" onchange="updateDataDisplay()">
                            <option value="">全て表示</option>
                            <option value="Power">Power</option>
                            <option value="T4-Kills">T4-Kills</option>
                            <option value="T5-Kills">T5-Kills</option>
                            <option value="Total Kill Points">Total Kill Points</option>
                            <option value="Dead Troops">Dead Troops</option>
                            <option value="Troops Power">Troops Power</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label>表示数:</label>
                        <select id="dataLimit" onchange="updateItemsPerPage()">
                            <option value="50">50件</option>
                            <option value="100">100件</option>
                            <option value="300">300件</option>
                            <option value="500">500件</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label>並び順:</label>
                        <select id="dataSortColumn">
                            <option value="">選択してください</option>
                            <option value="Data">日付</option>
                            <option value="ID">ID</option>
                            <option value="Name">名前</option>
                            <option value="Power">Power</option>
                            <option value="Alliance">アライアンス</option>
                            <option value="T4-Kills">T4-Kills</option>
                            <option value="T5-Kills">T5-Kills</option>
                            <option value="Total Kill Points">Total Kill Points</option>
                        </select>
                        <select id="dataSortOrder">
                            <option value="desc">降順</option>
                            <option value="asc">昇順</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="search-box">
                    <label for="searchInput" class="sr-only">検索</label>
                    <input type="text" id="searchInput" placeholder="🔍 名前、ID、同盟で検索..." aria-label="名前、ID、同盟で検索" oninput="filterData()">
                </div>
                <div class="date-range-indicator" id="dateRangeIndicator" style="display: none;">
                    期間: <span id="dateRangeText">-</span>
                </div>
            </div>

            <div class="table-container">
                <table id="dataTable" role="table" aria-label="ROKプレイヤーデータテーブル">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 60px; text-align: center;">No.</th>
                            <th scope="col" class="sortable" onclick="sortTable('Data')" tabindex="0" aria-sort="none">日付</th>
                            <th scope="col" class="sortable" onclick="sortTable('ID')" tabindex="0" aria-sort="none">ID</th>
                            <th scope="col" class="sortable" onclick="sortTable('Name')" tabindex="0" aria-sort="none">名前</th>
                            <th scope="col" class="sortable" onclick="sortTable('Power')" tabindex="0" aria-sort="none">Power</th>
                            <th scope="col" class="sortable" onclick="sortTable('Alliance')" tabindex="0" aria-sort="none">同盟</th>
                            <th scope="col" class="sortable" onclick="sortTable('T4-Kills')" tabindex="0" aria-sort="none">T4-Kills</th>
                            <th scope="col" class="sortable" onclick="sortTable('T5-Kills')" tabindex="0" aria-sort="none">T5-Kills</th>
                            <th scope="col" class="sortable" onclick="sortTable('Total Kill Points')" tabindex="0" aria-sort="none">Total Kill Points</th>
                            <th scope="col" class="sortable" onclick="sortTable('Dead Troops')" tabindex="0" aria-sort="none">Dead Troops</th>
                            <th scope="col" class="sortable" onclick="sortTable('Troops Power')" tabindex="0" aria-sort="none">Troops Power</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="11" class="loading">
                                <div class="loading-spinner"></div>
                                <p>CSVファイルを読み込み中...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script src="dataList.js"></script>
</body>
</html>
