<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVKノルマチェック - ROK Kingdom Data</title>
    <meta name="description" content="Rise of Kingdoms KVKノルマ達成状況チェッカー">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏰</text></svg>">

    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" defer></script>
</head>
<body>
    <div class="container">
        <h1 style="cursor: pointer;" onclick="window.location.href='home.html'" title="ホームに戻る">⚔️ ROK Kingdom Data</h1>
        <div class="subtitle">KVKノルマチェック</div>
        <div class="update-info">
            CSVファイル最終更新: <span id="updateDate">確認中...</span> |
            データ件数: <span id="dataCount">-</span>件
        </div>

        <!-- ナビゲーション -->
        <nav style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <a href="home.html" style="padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 8px;">← ホームに戻る</a>
            <a href="kvkList.html" style="padding: 10px 20px; background: #27ae60; color: white; text-decoration: none; border-radius: 8px;">KVKノルマ一覧</a>
        </nav>

        <!-- KVKノルマチェッカーコンテンツ -->
        <div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
            <!-- ヘッダーセクション -->
            <div style="text-align: center; margin-bottom: 45px;">
                <h2 style="color: #2c3e50; font-size: 34px; margin-bottom: 15px; font-weight: 700;">
                    ⚔️ KVKノルマチェッカー
                </h2>
                <p style="color: #7f8c8d; font-size: 16px;">プレイヤーのKVKノルマ達成状況を確認 & Power帯別ノルマ基準値</p>
                <div style="width: 80px; height: 2px; background: #3498db; margin: 15px auto;"></div>
            </div>

            <!-- KVKノルマチェッカーセクション -->
            <div style="margin-bottom: 50px;">
                <!-- プレイヤー検索セクション -->
                <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px;">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; font-size: 20px; margin-bottom: 10px;">プレイヤー検索</h3>
                        <p style="color: #7f8c8d; font-size: 14px;">プレイヤー名またはIDを入力してKVKノルマの進捗を確認</p>
                    </div>

                    <div style="display: flex; gap: 15px; align-items: center; justify-content: center; flex-wrap: wrap;">
                        <input type="text" id="kvkPlayerSearch" placeholder="プレイヤー名またはIDを入力"
                               style="padding: 12px 20px; border: 2px solid #e0e0e0; border-radius: 30px; font-size: 16px; min-width: 300px; transition: all 0.3s;"
                               onkeypress="if(event.key==='Enter') searchKvkPlayer()">
                        <button onclick="searchKvkPlayer()"
                                style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 30px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                            検索
                        </button>
                    </div>
                </div>

                <!-- プレイヤー情報表示エリア -->
                <div id="kvkPlayerResult" style="display: none;">
                    <!-- プレイヤー基本情報 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h3 id="kvkPlayerName" style="font-size: 24px; margin-bottom: 5px;">-</h3>
                                <p style="opacity: 0.9;">ID: <span id="kvkPlayerId">-</span> | 同盟: <span id="kvkPlayerAlliance">-</span></p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 14px; opacity: 0.9;">現在のPower</div>
                                <div id="kvkPlayerPower" style="font-size: 20px; font-weight: 700;">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- KVKノルマ進捗メーター -->
                    <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 25px;">
                        <h3 style="color: #2c3e50; text-align: center; margin-bottom: 25px; font-size: 20px;">KVKノルマ進捗状況</h3>

                        <!-- 期間表示 -->
                        <div style="text-align: center; margin-bottom: 20px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <span style="color: #7f8c8d; font-size: 14px;">分析期間: <span id="kvkAnalysisPeriod">-</span></span>
                        </div>

                        <!-- 撃破ノルマ進捗 -->
                        <div style="margin-bottom: 30px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="color: #2c3e50; font-size: 16px; margin: 0;">撃破ノルマ (Kill Points)</h4>
                                <span id="kvkKillProgress" style="font-weight: 600; color: #e74c3c;">0 / 0</span>
                            </div>
                            <div style="background: #e0e0e0; border-radius: 10px; height: 20px; overflow: hidden;">
                                <div id="kvkKillProgressBar" style="background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%); height: 100%; width: 0%; transition: width 0.5s ease; border-radius: 10px; position: relative;">
                                    <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: white; font-size: 12px; font-weight: 600;" id="kvkKillPercentage">0%</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; color: #7f8c8d;">
                                <span>開始時: <span id="kvkKillStart">-</span></span>
                                <span>目標: <span id="kvkKillTarget">-</span></span>
                                <span>現在: <span id="kvkKillCurrent">-</span></span>
                            </div>
                        </div>

                        <!-- 戦死ノルマ進捗 -->
                        <div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="color: #2c3e50; font-size: 16px; margin: 0;">戦死ノルマ (Dead Troops)</h4>
                                <span id="kvkDeathProgress" style="font-weight: 600; color: #f39c12;">0 / 0</span>
                            </div>
                            <div style="background: #e0e0e0; border-radius: 10px; height: 20px; overflow: hidden;">
                                <div id="kvkDeathProgressBar" style="background: linear-gradient(90deg, #f39c12 0%, #e67e22 100%); height: 100%; width: 0%; transition: width 0.5s ease; border-radius: 10px; position: relative;">
                                    <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: white; font-size: 12px; font-weight: 600;" id="kvkDeathPercentage">0%</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; color: #7f8c8d;">
                                <span>開始時: <span id="kvkDeathStart">-</span></span>
                                <span>目標: <span id="kvkDeathTarget">-</span></span>
                                <span>現在: <span id="kvkDeathCurrent">-</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- ノルマ達成状況サマリー -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); text-align: center;">
                            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 5px;">撃破ノルマまで</div>
                            <div id="kvkKillRemaining" style="font-size: 20px; font-weight: 700; color: #e74c3c;">-</div>
                            <div id="kvkKillStatus" style="font-size: 12px; margin-top: 5px; padding: 4px 8px; border-radius: 20px; display: inline-block;">-</div>
                        </div>

                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); text-align: center;">
                            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 5px;">戦死ノルマまで</div>
                            <div id="kvkDeathRemaining" style="font-size: 20px; font-weight: 700; color: #f39c12;">-</div>
                            <div id="kvkDeathStatus" style="font-size: 12px; margin-top: 5px; padding: 4px 8px; border-radius: 20px; display: inline-block;">-</div>
                        </div>

                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); text-align: center;">
                            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 5px;">総合達成率</div>
                            <div id="kvkOverallProgress" style="font-size: 20px; font-weight: 700; color: #3498db;">-</div>
                            <div id="kvkOverallStatus" style="font-size: 12px; margin-top: 5px; padding: 4px 8px; border-radius: 20px; display: inline-block;">-</div>
                        </div>
                    </div>

                    <!-- 日次進捗グラフセクション -->
                    <div style="margin-top: 30px;">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h3 style="color: #2c3e50; font-size: 20px; margin-bottom: 10px;">📈 日次進捗グラフ</h3>
                            <p style="color: #7f8c8d; font-size: 14px;">9/24からの撃破数・戦死数の推移</p>
                        </div>

                        <!-- 撃破数グラフ -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 20px;">
                            <h4 style="color: #2c3e50; text-align: center; margin-bottom: 20px; font-size: 18px;">撃破数 (Kill Points) 推移</h4>
                            <div style="position: relative; height: 300px;">
                                <canvas id="kvkKillChart"></canvas>
                            </div>
                        </div>

                        <!-- 戦死数グラフ -->
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.08);">
                            <h4 style="color: #2c3e50; text-align: center; margin-bottom: 20px; font-size: 18px;">戦死数 (Dead Troops) 推移</h4>
                            <div style="position: relative; height: 300px;">
                                <canvas id="kvkDeathChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 検索前のガイド -->
                <div id="kvkSearchGuide" style="text-align: center; padding: 40px 20px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">🔍</div>
                    <h3 style="color: #2c3e50; margin-bottom: 10px;">プレイヤーを検索してください</h3>
                    <p style="color: #7f8c8d; line-height: 1.6; margin-bottom: 20px;">
                        上の検索ボックスにプレイヤー名またはIDを入力して、KVKノルマの達成状況を確認できます
                    </p>
                    <div style="padding: 15px; background: #e8f4fd; border-radius: 8px; max-width: 400px; margin: 0 auto;">
                        <p style="color: #34495e; font-size: 14px; margin: 0;">💡 9/24からの最新データまでの進捗を自動計算し、Power帯に応じたノルマを判定します</p>
                    </div>
                </div>
            </div>

            <!-- ノルマ表セクション -->
            <div>
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px; font-weight: 700;">
                        📋 Power帯別ノルマ基準値
                    </h2>
                    <p style="color: #7f8c8d; font-size: 14px;">各Power帯の撃破ノルマ・戦死ノルマ一覧</p>
                </div>

                <!-- メインノルマテーブル -->
                <div style="background: white; border-radius: 15px; padding: 0; box-shadow: 0 5px 20px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 40px;">
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);">
                                    <th style="padding: 18px 20px; color: white; font-size: 14px; font-weight: 600; text-align: center; min-width: 100px;">Power帯</th>
                                    <th style="padding: 18px 20px; color: white; font-size: 14px; font-weight: 600; text-align: center; border-left: 1px solid rgba(255,255,255,0.1);">撃破ノルマ<br><span style="font-size: 11px; opacity: 0.8;">Kill Points</span></th>
                                    <th style="padding: 18px 20px; color: white; font-size: 14px; font-weight: 600; text-align: center; border-left: 1px solid rgba(255,255,255,0.1);">戦死ノルマ<br><span style="font-size: 11px; opacity: 0.8;">Deaths</span></th>
                                    <th style="padding: 18px 20px; color: white; font-size: 14px; font-weight: 600; text-align: center; border-left: 1px solid rgba(255,255,255,0.1);">Death Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background: #ffffff;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">45M - 59.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">75,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">198,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0033</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">60M - 64.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">150,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">214,500</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0033</td>
                                </tr>
                                <tr style="background: #ffffff;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">65M - 69.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">150,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">231,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0033</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">70M - 74.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">187,500,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">315,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0042</td>
                                </tr>
                                <tr style="background: #ffffff;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">75M - 79.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">187,500,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">336,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0042</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">80M - 84.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">200,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">425,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0050</td>
                                </tr>
                                <tr style="background: #ffffff;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">85M - 89.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">200,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">450,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0050</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">90M - 94.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">300,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">551,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0058</td>
                                </tr>
                                <tr style="background: #ffffff;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">95M - 99.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">300,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">580,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0058</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">100M - 149.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">600,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">1,005,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0067</td>
                                </tr>
                                <tr style="background: #ffffff;">
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 600; color: #2c3e50; font-size: 14px;">150M - 199.9M</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #e74c3c; font-size: 18px;">600,000,000</td>
                                    <td style="padding: 16px 20px; text-align: center; font-weight: 700; color: #f39c12; font-size: 18px;">1,340,000</td>
                                    <td style="padding: 16px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">0.0067</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 補足説明 -->
                <div style="background: #e8f4fd; border-radius: 10px; padding: 25px; border-left: 4px solid #3498db;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px; font-weight: 600;">📋 ノルマについて</h4>
                    <ul style="color: #34495e; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li style="margin-bottom: 8px;"><strong>Power帯：</strong>プレイヤーの戦力による区分</li>
                        <li style="margin-bottom: 8px;"><strong>撃破ノルマ：</strong>KVK期間中に達成すべきKill Points目標</li>
                        <li style="margin-bottom: 8px;"><strong>戦死ノルマ：</strong>KVK期間中に達成すべき戦死目標</li>
                        <li style="margin-bottom: 8px;"><strong>Death Rate：</strong>Power帯に対する戦死率の基準値</li>
                    </ul>
                    <div style="margin-top: 20px; padding: 15px; background: #fff9e6; border-radius: 8px;">
                        <p style="color: #856404; margin: 0; font-size: 14px;">
                            <strong>⚠️ 注意事項：</strong>これらの数値は参考基準です。実際のKVKでは状況に応じて調整される場合があります。
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script src="kvkChecker.js"></script>
</body>
</html>
